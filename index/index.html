<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Tmap WebView</title>
  <script src="https://apis.openapi.sk.com/tmap/jsv2?version=1&appKey=OjCMpSA1xX1U1j0OSGb7SjbWT8F13RI18ZVR17z2"></script>
  <style>
    html, body, #map_div {
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
    }
  </style>
</head>

<body onload="initTmap()">
  <div id="map_div"></div>

  <script>
    let map, marker;

    function initTmap() {
      map = new Tmapv2.Map("map_div", {
        center: new Tmapv2.LatLng(37.5665, 126.9780), // 초기 위치
        width: "100%",
        height: "100%",
        zoom: 19
      });
    }

    function moveToLocation(lat, lng) {
      const position = new Tmapv2.LatLng(lat, lng);
      map.setCenter(position);

      if (marker) marker.setMap(null);

      marker = new Tmapv2.Marker({
        position: position,
        icon: "https://maps.google.com/mapfiles/ms/icons/red-dot.png",
        iconSize: new Tmapv2.Size(36, 38),
        map: map
      });
    }

    document.addEventListener("message", (event) => {
      try {
        const data = JSON.parse(event.data);
        moveToLocation(data.latitude, data.longitude);
      } catch (e) {
        console.error("❌ 잘못된 메시지:", e);
      }
    });
  </script>
</body>
</html>
